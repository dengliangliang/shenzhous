<view class="statement-container"><view class="nav-header"><view class="tabs-container"><view class="tabs"><block wx:if="{{isOwner}}"><view data-event-opts="{{[['tap',[['switchTab',[0]]]]]}}" class="{{['tab-item',(currentTab===0)?'active':'']}}" bindtap="__e"><text>总账单</text><block wx:if="{{currentTab===0}}"><view class="tab-line"></view></block></view></block><view data-event-opts="{{[['tap',[['switchTab',[isOwner?1:0]]]]]}}" class="{{['tab-item',(currentTab===(isOwner?1:0))?'active':'']}}" bindtap="__e"><text>我的账单</text><block wx:if="{{currentTab===(isOwner?1:0)}}"><view class="tab-line"></view></block></view></view></view></view><view class="statement-summary"><view class="summary-card"><view class="summary-header"><text>{{currentTab===0&&isOwner?'账单统计':'我的交易'}}</text><block wx:if="{{currentPeriodInfo&&!currentPeriodInfo.isAll}}"><view class="current-period-badge">{{'当前第'+currentPeriodInfo.number+'期'}}</view></block></view><view class="summary-content"><view class="summary-item"><text class="value">{{"¥ "+monthlyBill.month}}</text><text class="label">{{currentTab===0&&isOwner?'总交易额':'我的交易额'}}</text></view><view class="summary-divider"></view><view class="summary-item"><text class="value">{{monthlyBill.number}}</text><text class="label">交易笔数</text></view></view><block wx:if="{{currentTab===0&&isOwner&&eligibilityInfo&&eligibilityInfo.status===0&&monthlyBill.treatSettlementAmount!==0.00}}"><view class="settle-button-container"><button data-event-opts="{{[['tap',[['settleStatements',['$event']]]]]}}" class="settle-button" bindtap="__e"><uni-icons vue-id="61c48758-1" type="weixin" size="20" color="#FFFFFF" bind:__l="__l"></uni-icons><text>微信结算账单</text></button></view></block><block wx:if="{{currentTab===0&&isOwner&&eligibilityInfo&&eligibilityInfo.status===1}}"><view class="invalid-eligibility-tip"><uni-icons vue-id="61c48758-2" type="info" size="16" color="#FF4D4F" bind:__l="__l"></uni-icons><text>月结资格已失效，无法进行结算操作</text></view></block><block wx:if="{{currentPeriodInfo&&!currentPeriodInfo.isAll}}"><view class="period-info"><uni-icons vue-id="61c48758-3" type="calendar" size="16" color="#FFFFFF" bind:__l="__l"></uni-icons><text>{{currentPeriodInfo.startDate+" 至 "+currentPeriodInfo.endDate}}</text></view></block><block wx:if="{{currentPeriodInfo&&currentPeriodInfo.isAll}}"><view class="period-info"><uni-icons vue-id="61c48758-4" type="calendar" size="16" color="#FFFFFF" bind:__l="__l"></uni-icons><text>显示全部账单记录</text></view></block></view></view><view class="filter-card"><view data-event-opts="{{[['tap',[['toggleFilterPanel',['$event']]]]]}}" class="filter-header" bindtap="__e"><text>筛选条件</text><uni-icons vue-id="61c48758-5" type="{{showFilterPanel?'top':'bottom'}}" size="14" color="#666" bind:__l="__l"></uni-icons></view><block wx:if="{{showFilterPanel}}"><view class="filter-body"><view class="filter-row"><view class="filter-label"><uni-icons vue-id="61c48758-6" type="calendar" size="16" color="#FF6B01" bind:__l="__l"></uni-icons><text>时间范围</text></view><view class="date-pickers"><picker class="date-picker" mode="date" value="{{startDate}}" data-event-opts="{{[['change',[['onStartDateChange',['$event']]]]]}}" bindchange="__e"><view class="picker-content"><text>{{displayStartDate||'开始日期'}}</text><uni-icons vue-id="61c48758-7" type="right" size="12" color="#CCCCCC" bind:__l="__l"></uni-icons></view></picker><text class="date-separator">至</text><picker class="date-picker" mode="date" value="{{endDate}}" data-event-opts="{{[['change',[['onEndDateChange',['$event']]]]]}}" bindchange="__e"><view class="picker-content"><text>{{displayEndDate||'结束日期'}}</text><uni-icons vue-id="61c48758-8" type="right" size="12" color="#CCCCCC" bind:__l="__l"></uni-icons></view></picker></view></view><view class="filter-row"><view class="filter-label"><uni-icons vue-id="61c48758-9" type="list" size="16" color="#FF6B01" bind:__l="__l"></uni-icons><text>交易类型</text></view><view class="filter-tabs"><view data-event-opts="{{[['tap',[['selectType',[null]]]]]}}" class="{{['filter-tab',(selectedType===null)?'active':'']}}" bindtap="__e">全部</view><view data-event-opts="{{[['tap',[['selectType',[0]]]]]}}" class="{{['filter-tab',(selectedType===0)?'active':'']}}" bindtap="__e">支付</view><view data-event-opts="{{[['tap',[['selectType',[1]]]]]}}" class="{{['filter-tab',(selectedType===1)?'active':'']}}" bindtap="__e">退款</view></view></view><view class="filter-actions"><button data-event-opts="{{[['tap',[['resetFilters',['$event']]]]]}}" class="filter-btn reset" bindtap="__e"><uni-icons vue-id="61c48758-10" type="reload" size="14" color="#666666" bind:__l="__l"></uni-icons><text>重置</text></button><button data-event-opts="{{[['tap',[['applyFilters',['$event']]]]]}}" class="filter-btn apply" bindtap="__e"><uni-icons vue-id="61c48758-11" type="search" size="14" color="#FFFFFF" bind:__l="__l"></uni-icons><text>应用筛选</text></button></view></view></block></view><block wx:if="{{hasValidCycles}}"><view class="cycle-selector"><view data-event-opts="{{[['tap',[['toggleCyclePanel',['$event']]]]]}}" class="cycle-header" bindtap="__e"><text>历史周期查询</text><text class="current-cycle">{{selectedCycleName}}</text><uni-icons vue-id="61c48758-12" type="{{showCyclePanel?'top':'bottom'}}" size="14" color="#666" bind:__l="__l"></uni-icons></view><block wx:if="{{showCyclePanel}}"><view class="cycle-panel"><scroll-view class="cycle-list" scroll-y="{{true}}"><block wx:for="{{settlementCycles}}" wx:for-item="cycle" wx:for-index="index" wx:key="index"><view data-event-opts="{{[['tap',[['selectCycle',[index]]]]]}}" class="{{['cycle-item',(currentCycleIndex===index)?'active':'']}}" bindtap="__e"><view class="cycle-name">{{"第"+cycle.number+"期"}}</view><view class="cycle-date">{{cycle.startDate+" 至 "+cycle.endDate}}</view><block wx:if="{{cycle.isCurrent}}"><view class="cycle-status">当前周期</view></block><block wx:if="{{!cycle.isCurrent}}"><view class="history-badge">历史周期</view></block></view></block></scroll-view></view></block></view></block><block wx:if="{{!hasValidCycles}}"><view class="no-cycles-tip"><uni-icons vue-id="61c48758-13" type="info" size="16" color="#FAAD14" bind:__l="__l"></uni-icons><text>当前月结资格暂无历史周期数据</text></view></block><view class="list-header"><text>账单明细</text><text class="list-count">{{"共 "+monthlyBill.number+" 笔"}}</text></view><scroll-view class="statement-list-container" style="{{'height:'+('calc(100vh - 450rpx)')+';'}}" scroll-y="{{true}}" data-event-opts="{{[['scrolltolower',[['loadMoreData',['$event']]]]]}}" bindscrolltolower="__e"><view class="statement-list"><block wx:for="{{statementList}}" wx:for-item="item" wx:for-index="index" wx:key="monthlyStatementId"><view data-event-opts="{{[['tap',[['viewStatementDetail',['$0'],[[['statementList','monthlyStatementId',item.monthlyStatementId]]]]]]]}}" class="{{['statement-item',(index<10)?'animate-in':'']}}" style="{{'animation-delay:'+(index*0.05+'s')+';'}}" bindtap="__e"><view class="item-header"><view class="order-info"><text class="order-id">{{"订单号: "+item.orderId}}</text><text class="time">{{item.createTime}}</text></view><view class="{{['type-tag',(item.type===1)?'refund':'']}}">{{''+(item.type===0?'支付':'退款')+''}}</view></view><view class="item-content"><text class="{{['amount',(item.type===1)?'refund':'']}}">{{''+(item.type===0?'+':'-')+" ¥"+item.amount+''}}</text></view><view class="item-footer"><block wx:if="{{item.isUserPays===1||item.type===0}}"><view class="{{['payment-status',(item.isUserPays===1)?'paid':'']}}">{{''+(item.isUserPays===1?'已结算':'未结算')+''}}</view></block><view class="flex-space"></view><view class="detail-link"><text>查看详情</text><uni-icons vue-id="{{'61c48758-14-'+index}}" type="right" size="12" color="#999999" bind:__l="__l"></uni-icons></view></view></view></block><block wx:if="{{loading&&hasMoreData}}"><view class="load-more"><view class="loading-spinner"></view><text>加载更多...</text></view></block><block wx:if="{{$root.g0}}"><view class="no-more-data"><text>已经到底啦</text></view></block></view></scroll-view></view>